<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-Young OS</title>
    <link rel="stylesheet" href="https://unpkg.com/7.css@0.10.2/dist/95.css">
    <style>
        :root { --teal: #008080; }
        body { background-color: var(--teal); margin: 0; padding: 0; font-family: "Pixelated MS Sans Serif", Arial, sans-serif; height: 100vh; overflow: hidden; }
        
        #desktop { 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            flex-wrap: wrap; 
            align-content: flex-start; 
            gap: 20px; 
            height: calc(100vh - 40px); 
        }

        .icon { 
            width: 75px; 
            text-align: center; 
            cursor: pointer; 
            user-select: none; 
            padding: 5px;
        }
        .icon:hover { background: rgba(0,0,0,0.1); outline: 1px dotted #fff; }
        .icon img { width: 32px; height: 32px; display: block; margin: 0 auto 5px; image-rendering: pixelated; }
        .icon span { color: white; font-size: 11px; text-shadow: 1px 1px #000; line-height: 1.2; display: block; }

        .window { position: absolute; min-width: 300px; z-index: 10; box-shadow: 2px 2px 10px rgba(0,0,0,0.5); }
        .folder-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); 
            gap: 15px; 
            padding: 15px; 
            background: white; 
            border: 2px inset #dfdfdf; 
            min-height: 150px; 
            max-height: 400px;
            overflow-y: auto;
        }

        .asset-preview { text-align: center; font-size: 10px; color: black; }
        .asset-preview img { max-width: 64px; height: auto; border: 1px solid #777; margin-bottom: 4px; }

        .taskbar { position: fixed; bottom: 0; left: 0; right: 0; height: 30px; background: #c0c0c0; border-top: 2px solid #fff; display: flex; align-items: center; padding: 2px; z-index: 9999; }
        .start-btn { font-weight: bold; padding: 2px 6px; border: 2px solid; border-color: #fff #808080 #808080 #fff; display: flex; align-items: center; gap: 4px; cursor: pointer; height: 22px; }
        .start-btn:active { border-color: #808080 #fff #fff #808080; }
        .time { margin-left: auto; border: 2px inset #fff; padding: 2px 8px; font-size: 12px; background: #c0c0c0; }
    </style>
</head>
<body>

<div id="desktop">
    </div>

<div class="taskbar">
    <div class="start-btn">
        <img src="https://win95.xyz/icons/windows-0.png" width="16">
        Start
    </div>
    <div class="time" id="clock"></div>
</div>

<script>
    const USER = 'ghxstxch';
    const REPO = 'tyoung-site';
    const desktop = document.getElementById('desktop');

    // Initialize Clock
    function updateClock() {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }
    setInterval(updateClock, 1000); updateClock();

    // 1. AUTO-POPULATE DESKTOP
    async function initDesktop() {
        try {
            const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/assets`);
            const items = await res.json();

            items.forEach(item => {
                if (item.type === 'dir') {
                    createDesktopIcon(item.name, item.path);
                }
            });
        } catch (e) {
            console.error("Failed to load desktop icons", e);
        }
    }

    function createDesktopIcon(name, path) {
        const div = document.createElement('div');
        div.className = 'icon';
        div.onclick = () => openFolder(path, name);
        div.innerHTML = `
            <img src="https://win95.xyz/icons/directory_closed-4.png">
            <span>${name}</span>
        `;
        desktop.appendChild(div);
    }

    // 2. OPEN WINDOWS
    async function openFolder(path, title) {
        const winId = `win-${path.replace(/\//g, '-')}`;
        if(document.getElementById(winId)) return; // Don't open same folder twice

        const win = document.createElement('div');
        win.className = 'window';
        win.id = winId;
        win.style.top = '100px';
        win.style.left = '150px';
        
        win.innerHTML = `
            <div class="title-bar">
                <div class="title-bar-text">C:/${path}</div>
                <div class="title-bar-controls">
                    <button aria-label="Close" onclick="this.closest('.window').remove()"></button>
                </div>
            </div>
            <div class="window-body">
                <div class="folder-grid">Loading...</div>
            </div>
        `;
        document.body.appendChild(win);
        makeDraggable(win);

        try {
            const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${path}`);
            const files = await res.json();
            const grid = win.querySelector('.folder-grid');
            grid.innerHTML = '';

            files.forEach(file => {
                const item = document.createElement('div');
                item.className = 'asset-preview';
                const isImg = file.name.match(/\.(jpg|jpeg|png|gif)$/i);
                
                item.innerHTML = `
                    <img src="${isImg ? file.download_url : 'https://win95.xyz/icons/file_lines-1.png'}">
                    <br>${file.name}
                `;
                grid.appendChild(item);
            });
        } catch (e) {
            win.querySelector('.folder-grid').innerText = "Access denied.";
        }
    }

    function makeDraggable(el) {
        let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
        el.querySelector('.title-bar').onmousedown = (e) => {
            pos3 = e.clientX; pos4 = e.clientY;
            document.onmouseup = () => { document.onmouseup = null; document.onmousemove = null; };
            document.onmousemove = (e) => {
                pos1 = pos3 - e.clientX; pos2 = pos4 - e.clientY;
                pos3 = e.clientX; pos4 = e.clientY;
                el.style.top = (el.offsetTop - pos2) + "px";
                el.style.left = (el.offsetLeft - pos1) + "px";
            };
        };
    }

    initDesktop();
</script>

</body>
</html>
